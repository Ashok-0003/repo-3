[[_TOC_]]
# Key Vault Secrets and Certificates
| Key Vault Name |Name|Type|How to Retrieve|Remarks (Exmaple UAT)|
|--|--|--|--|--|
|kv-cpd-apps-<env>-we-01|AdminPortal-ADAuth-ClientSecret|Secret|Create and Retrieve Client Secret for **spn-adminportal** app registration in B2C Tenant under certificates and secrets menu.||
|kv-cpd-apps-<env>-we-01|AdminPortal-AuthClaims-GroupId|Secret|Create and Navigate to "**Platformadmin**" Group in **Azure Active Directory > Groups** in B2C Tenant and retrieve the **object Id** of the group.||
|kv-cpd-apps-<env>-we-01|ARMAPI-ClientSecret|Secret|Client secret of the **spn-armapi-reader-npd** Service Principal ||
|kv-cpd-apps-<env>-we-01|Azure-Search-Key|Secret|Primary Admin key of resource srch-cpd-apps-cog-<env>-we-01 ||
|kv-cpd-apps-<env>-we-01|BotAppSecret|Secret|  Create client secret for **bot-cpd-apps<env>-we-01** WebAppBot resource and paste the value in this key. | [Refer steps](https://dev.azure.com/TASMUCP/TASMU%20Central%20Platform/_wiki/wikis/TASMU-Central-Platform.wiki/123/Chatbot-Information-and-Deployment-Steps?anchor=webapp-bot-ad-update) |
|kv-cpd-apps-<env>-we-01|Bot-AppSettings-LuisAuthSubscriptionKey| Secret | Primary key of the Azure Cognitive services resource **cog-cpd-apps-luiauth-<env>-we-01** | |
|kv-cpd-apps-<env>-we-01|Bot-AppSettinacrcppglobprdwe01-spngs-LuisRtSubscriptionKey| Secret | Primary key of the Azure Cognitive services resource **cog-cpd-apps-luisrt-<env>-we-01** | |
|kv-cpd-apps-<env>-we-01|Bot-AppSettings-QnaEnSubscriptionKey| Secret | Primary key of the Azure Cognitive services resource **appcog-cpd-apps-qna-<env>-we-01** | |
|kv-cpd-apps-<env>-we-01|Bot-AppSettings-QnaArSubscriptionKey| Secret | Primary key of the Azure Cognitive services resource **appcog-cpd-apps-arqna-<env>-we-01** | |
|kv-cpd-apps-<env>-we-01|CDNSettings-StorageAccount| Secret | Connection string of the resource **stcpdshrd<env>we01**|Eg `DefaultEndpointsProtocol=https;AccountName=stcpdshrduatwe01;AccountKey=<key>;EndpointSuffix=core.windows.net`|
|kv-cpd-apps-<env>-we-01|Ckan-Authorization-Token| Secret | Login to Opendata portal with Admin credentials and click on user name, left side bottom, find the **'API Key'**, the same guid value has to be stored in key vault.| Example: UAT portal value `8dacb687-b7ed-42db-b6df-67364f1181f5`|
|kv-cpd-apps-<env>-we-01|Ckan-ResourceCreateURL| Secret | `https://opendata.<env>.sqcp.qa/api/3/action/resource_create` | Example: `https://opendata.uat.sqcp.qa/api/3/action/resource_create`|
|kv-cpd-apps-<env>-we-01|Ckan-ResourceCreationFunctionURL| Secret | Retrieved after first deployment of platform apis -- Azure Portal > `func-<sub>-apps-ckan-<env>-we-01` > Functions > Resource Create > Get Function Url > Copy the default function key| Example: `https://func-cpd-apps-ckan-uat-we-01.azurewebsites.net/api/ResourceCreate?code=<key>`|
|kv-cpd-apps-<env>-we-01|CkanSettings-CkanStroageAccountConnectionString| Secret | Connection string of the storage account which is referred by ckan logic apps. Eg: **dlsopenzone<Env>we01** -- Go to Azure Portal > `**dlsopenzone<Env>we01**` > select Access Keys > key1 section > Copy the Connection string | Example: `DefaultEndpointsProtocol=https;AccountName=dlsopenzonedevwe01;AccountKey=*******************************************************************;EndpointSuffix=core.windows.net` set this value for the secret.|
|kv-cpd-apps-<env>-we-01|Cms-Function-ServiceBusConnectionString| Secret |Send,Listen access policy connection string of the resource **sb-cpd-apps-int-<env>-we-01**|
|kv-cpd-apps-<env>-we-01|Cms-Function-TenantId| Secret |Directory (tenant) ID of Azure AD App **spn-cmsbpa-<env>**|
|kv-cpd-apps-<env>-we-01|Cms-Function-ClientId| Secret |Application (client) ID of Azure AD app **spn-cmsbpa-<env>**|
|kv-cpd-apps-<env>-we-01|Cms-Function-CertificatePassword| Secret |**CMSBPA** certificate password of CMS-CMSBPA-<env>.pfx|
|kv-cpd-apps-<env>-we-01|Cms-Function-CertificatePfxKey| Secret |Base64 format of the PFX file associated with **CMSBPA** self signed certificate.| Steps to retrieve : (i) Make sure your `CMSBPA Pfx file` is present in the ADO secure files, authorize to use in all pipelines option should be enabled (ii) Verify the variables and run the pipeline [CD-SPO-Base64-Uat-Release](https://dev.azure.com/TASMUCP/TASMU%20Central%20Platform/_build?definitionId=965) (iii) A file will get created at TASMU CMS Marketplace site in Documents Library.  (iv) Open the generated `base64.txt` copy the entire content - that's the Pfx key. Eg. `MIIKgQIBAzCCCj0GCSqGSIb3DQE....`. **Delete base64.txt file once this variable is updated**|
|kv-cpd-apps-<env>-we-01|ConnectionStrings-AzureMapsApiKey|Secret|Primary Key of the resource **maps-<sub>-shrd-<env>-we-01**|Eg `ounbqFd*****************lUFig` |
|kv-cpd-apps-<env>-we-01|ConnectionStrings-ConsumptionStorageAccount|Secret|Connection string of the resource **stcpdglobacmwe01**|Eg `DefaultEndpointsProtocol=https;AccountName=stcpdglobacmwe01;AccountKey=<key>;EndpointSuffix=core.windows.net`|
|kv-cpd-apps-<env>-we-01|ConnectionStrings-CosmosDB|Secret| Settings-> Keys -> Connection String **cosmos-cpd-apps-str-<env>-we-01** |Eg. `AccountEndpoint=https://cosmos-<sub>-apps-str-<env>-we-01.documents.azure.com:443/;AccountKey=<key>`|
|kv-cpd-apps-<env>-we-01|ConnectionStrings-CosmosDBAuthKey|Secret| Settings-> Keys -> PrimaryKey **cosmos-cpd-apps-str-<env>-we-01** ||
|kv-cpd-apps-<env>-we-01|ConnectionStrings-DynamicsSqlExport|Secret| Connection string of Dynamics SQL export service database. See remarks column for sample. <br/> **This secret requires a tag with name as [organizationid](https://docs.microsoft.com/en-us/power-platform/admin/determine-org-id-name) of the target dynamics environment and tag value as respective Azure AD tenant id.** <br><br> **Example for the tag name and value**: 1e39380e-1c06-4e94-bb24-ecafb910bd8a, 92603419-35d1-4eb0-8427-cac731071355 | Ex. Server=tcp:sql-cpd-data-uat-we-01.database.windows.net,1433;Initial Catalog=sqldb-cpd-dynamics-data-uat-we-01;Persist Security Info=False;User ID=adminsa;Password=yourpassword;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30; |
|kv-cpd-apps-<env>-we-01|ConnectionStrings-DynamicsSql|Secret| Connection string of Dynamics SQL export service database. See remarks column for sample. <br/> This can be replaced with [Dynamics TDS endpoint](https://powerapps.microsoft.com/en-us/blog/tabular-data-stream-tds-protocol-endpoint-for-common-data-service-cds/) when it becomes GA. <br/> Until then the same value as 'ConnectionStrings-DynamicsSqlExport' can be used. | Ex. Server=tcp:sql-cpd-data-uat-we-01.database.windows.net,1433;Initial Catalog=sqldb-cpd-dynamics-data-uat-we-01;Persist Security Info=False;User ID=adminsa;Password=yourpassword;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30; |
|kv-cpd-apps-<env>-we-01|ConnectionStrings-IntegrationServiceBus| Secret |RootManagedAccessKey  connection string of the resource sb-cpd-apps-int-<env>-we-01 for deployment||
|kv-cpd-apps-<env>-we-01|ConnectionStrings-IoTHub| Secret |Retrieve connection string from **iot-cpd-data-<env>-we-01** -> **Shared access policies** -> **registryRead** -> **Connection-String-Primary Key**| Eg. `HostName=iot-cpd-data-uat-we-01.azure-devices.net;SharedAccessKeyName=registryRead;SharedAccessKey=<key>`|
|kv-cpd-apps-<env>-we-01|ConnectionStrings-NotificationHub| Secret | Retrieve connection string from **ntf-cpd-apps-str-{​​env}​​-we-01** -> **Access policies** -> **Policy name - DefaultFullSharedAccessSignature** -> **connection string** ||
|kv-cpd-apps-<env>-we-01|ConnectionStrings-Redis| Secret | Primary connection string of redis-cpd-apps-str-<env>-we-01|Eg.`redis-cpd-apps-str-uat-we-01.redis.cache.windows.net:6380,password=<>=,ssl=True,abortConnect=False`|
|kv-cpd-apps-<env>-we-01|ConnectionStrings-SmartParkingSQLDB| Secret |Form the connection string for **sql-cpd-data-<env>-we-01** with provided userid and pwd in example.|Eg.`Data Source=sql-cpd-data-<env>-we-01.database.windows.net;Initial Catalog=sqldb-cpd-data-<env>-we-01;User Id=spappslogin;Password=P@ssw0rd123`|
|kv-cpd-apps-<env>-we-01|ConnectionStrings-StorageAccount| Secret |Connection string of the resource **stcpdappsstr<env>we01**| Eg `DefaultEndpointsProtocol=https;AccountName=stcpdappsstruatwe01;AccountKey=<key>;EndpointSuffix=core.windows.net`|
|kv-cpd-apps-<env>-we-01|CPCoreApis-ClientSecret| Secret | Client secret of Central Platform Core APIs | |
|kv-cpd-apps-<env>-we-01|Crm-CaseManagement-DynamicsSettings-ClientSecret| Secret |Client secret stored in kv-cpd-apps-<env>-we-01 used for Case api connection, generate secret from Azure AD app registration.<p> UAT - spn-crm-case-management-integration-test<p>Client Secret : **********</p><p> TEST - spn-crm-case-management-integration-test<p>Client Secret : **********</p><p> DEV - spn-crm-case-management-integration-dev<p>Client Secret : **********</p>||
|kv-cpd-apps-<env>-we-01|Crm-Common-DynamicsSettings-ClientSecret| Secret |Client secret stored in kv-cpd-apps-<env>-we-01 used for common dynamic connection, generate secret from Azure AD app registration.<p> UAT - spn-crm-common-integration-test <p>Client Secret : **********</p><p> TEST - spn-crm-common-integration-test<p>Client Secret : **********</p><p> DEV - spn-crm-general-integration-dev<p>Client Secret : **********</p>||
|kv-cpd-apps-<env>-we-01|Crm-ProfileManagement-DynamicsSettings-ClientSecret| Secret |Client secret stored in kv-cpd-apps-<env>-we-01 used for Profile api connection, generate secret from Azure AD app registration.<p> UAT - spn-crm-profile-management-integration-test<p>Client Secret : **********</p><p> TEST - spn-crm-profile-management-integration-test<p>Client Secret : **********</p><p> DEV - spn-crm-profile-management-integration-dev<p>Client Secret : **********</p>||
|kv-cpd-apps-<env>-we-01|Crm-ProfileDaemon-DynamicsSettings-ClientSecret| Secret |Client secret stored in kv-cpd-apps-<env>-we-01 used for Profile api connection in Profile function app, generate secret from Azure AD app registration.<p> UAT - spn-crm-profile-daemon-integration-test<p>Client Secret : **********</p><p> TEST - spn-crm-profile-daemon-integration-test<p>Client Secret : **********</p><p> DEV - spn-crm-profile-daemon-integration-dev<p>Client Secret : **********</p>||
|kv-cpd-apps-<env>-we-01|EventGridSettings-DomainKey| Secret | Access key of egd-cpd-apps-int-<env>-we-01||
|kv-cpd-apps-<env>-we-01|GraphClientSecret| Secret | Client Secret of TASMU-Portal app on Azure B2C Tenant ||
|kv-cpd-apps-<env>-we-01|ManageEventFunction-AzureADOptions-ClientSecret| Secret | Client Secret of ManageEventFunction app on Azure B2C Tenant | |
|kv-cpd-apps-<env>-we-01|NotificationFunctionSettings-SendGridApiKey| Secret | **Sendgrid API key to be provided by customer.** |
|kv-cpd-apps-<env>-we-01|NotificationSettings-AzureADOptions-ClientSecret| Secret | Client Secret for Notification API App Registration in B2C tenant||
|kv-cpd-apps-<env>-we-01|NotificationSettings-GSMSKey| Secret | Government SMS Provider Password, key to be provided by customer.||
|kv-cpd-apps-<env>-we-01|NotificationSettings-NotificationServiceBusConnectionString| Secret | Connection string of SAS policy (RootManageSharedAccessKey) of resource `sb-cpd-apps-strntf-<env>-we-01` ||
|kv-cpd-apps-<env>-we-01|NotificationSettings-SmsApiName| Secret | Ooredoo SMS Gateway Provider API Name, key to be provided by customer.||
|kv-cpd-apps-<env>-we-01|NotificationSettings-SmsApiPassword| Secret | Ooredoo SMS Gateway Password, key to be provided by customer.||
|kv-cpd-apps-<env>-we-01|OrganisationApi-AzureADOptions-ClientSecret| Secret | Client Secret of **Central-Platform-Core-APIs** app on Azure B2C Tenant ||
|kv-cpd-apps-<env>-we-01|PaymentGWSettings-AuthorizeCard-ClientSecret| Secret | Client Secret of **TASMU Portal** app on Azure B2C Tenant ||
|kv-cpd-apps-<env>-we-01|PaymentGWSettings-AuthorizeCard-Password| Secret |Ooredoo Payment Gateway Password, key to be provided by customer.||
|kv-cpd-apps-<env>-we-01|PaymentGWSettings-GetPaymentPreferenceServiceURL| Secret |Retrieve function app URL from the Info function in func-cpd-apps-pt-<env>-we-01. Replace the string 'profileID' with the digit 0.| Eg: `https://func-cpd-apps-pt-<env>-we-01.azurewebsites.net/api/Info/{0}?code='code'` |
|kv-cpd-apps-<env>-we-01|PaymentGWSettings-TerminalPwd| Secret |Ooredoo Payment Gateway Terminal password provided by customer.||
|kv-cpd-apps-<env>-we-01|PaymentGWSettings-Token| Secret |Ooredoo Payment Gateway Token provided by customer.||
|kv-cpd-apps-<env>-we-01|PaymentGWSettings-UpdatePaymentPreferenceServiceURL| Secret | Retrieve function app URL from the UpdateInfo function in func-cpd-apps-pt-<env>-we-01.|Example: `https://func-cpd-apps-pt-<env>-we-01.azurewebsites.net/api/UpdateInfo?code='code'` |
|kv-cpd-apps-<env>-we-01|PowerBIEmbed-AzureAd-ClientSecret| Secret |Client Secret for **spn-powerbiembed** [app registration](https://dev.azure.com/TASMUCP/TASMU%20Central%20Platform/_wiki/wikis/TASMU-Central-Platform.wiki/138/Non-Prod-Environments?anchor=application-registrations-in-azure-ad---tasmusqcp.onmicrosoft.com) ||
|kv-cpd-apps-<env>-we-01|Purview-AcquireAccess-TokenReqBody| Secret | `grant_type=client_credentials&client_id=client id of app registration spn-purview-<env>&client_secret=client secret of app registration spn-purview-<env>&resource=73c2949e-da2d-457a-9607-fcc665198967` |Example: `grant_type=client_credentials&client_id=9ac3fe30-5ed6-4a5e-b6fa-7abcbfe3f7cb&client_secret=<secret>&resource=73c2949e-da2d-457a-9607-fcc665198967`|
|kv-cpd-apps-<env>-we-01|SmartParking-ADAuth-ClientSecret| Secret |create and retrieve Client Secret for **Smart Parking API** App registration in B2C tenant under certificates and secrets menu||
|kv-cpd-apps-<env>-we-01|Cms-Function-ClientCertificate| Certificate |Certificate used to authenticate to SharePoint| CMSBPA Self signed certificate|
|kv-cpd-apps-<env>-we-01|Cms-Api-ClientCertificate| Certificate |Certificate used to authenticate to SharePoint|CMSAPI Self signed certificate| 

# Notes 
1. All the connection strings and client secrets should be rotated periodically
2. AKS pods require restart to use new configurations and secrets. (Restart is taken care in CD-AppConfiguration-Master-Release)